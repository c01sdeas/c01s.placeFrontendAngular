<div class="flex flex-col justify-center w-full border-neutral-600 pb-3 pt-3 border-l pl-6">
    <div class="flex flex-row justify-between items-center w-full">
        <span class="text-sm flex flex-row justify-start items-start">
            {{ comment.createdAt | date: 'MM/dd/yyyy h:mm a z' }}
        </span>

        @if(sessionUsername==comment.username){
            <div class="flex flex-row items-center">
                <p-button icon="pi pi-ellipsis-v" variant="text" size="small" severity="secondary" (click)="selectCommentForMenu(comment);menu.toggle($event);"/>
                <p-menu #menu [model]="commentMenuItems" [popup]="true"/>
            </div>
        }
    </div>
    <span class="flex flex-row items-center">
        <i class="pi pi-user mr-2"></i>{{ comment.userNickname }}
    </span>
    <div class="flex flex-row">
        @if(editCommentData._id==comment._id && editCommentDialogVisible){
            <div class="flex flex-col w-full">
                <textarea name="comment" pTextarea placeholder="Write a comment..." [(ngModel)]="editCommentRequestData.comment" class="p-2 w-full h-24 resize-none transition-all duration-300 ease-in-out"></textarea>
                <div class="flex flex-row items-center justify-end mt-2 w-full h-12">
                    <p-button icon="pi pi-times" label="Cancel" severity="secondary" variant="text" (click)="hideEditCommentDialog()" class="transition-all duration-300 ease-in-out"/>
                    <p-button icon="pi pi-check" label="Share comment" pTooltip="Share comment" (click)="editComment()" class="transition-all duration-300 ease-in-out"/>
                </div>
            </div>
        } @else {
            <p class="font-lato w-full mt-2 flex items-center">{{ comment.comment }}</p>
        }
    </div>

    <div class="flex flex-row">
        <p-button severity="secondary" variant="text" pTooltip="Up vote" [disabled]="updateCommentVoteButtonLoading" (click)="updateCommentVote({commentID:comment._id,vote:1})">
            @if(comment.vote==1){
                <i class="pi pi-thumbs-up-fill"></i>
            } @else {
                <i class="pi pi-thumbs-up"></i>
            }
            @if(comment.voteCount>0){
                <span class="ml-2">+{{comment.voteCount}} vote@if(comment.voteCount>1){s}</span>
            }
        </p-button>
        <p-button severity="secondary" variant="text" pTooltip="Down vote" [disabled]="updateCommentVoteButtonLoading" (click)="updateCommentVote({commentID:comment._id,vote:-1})">
            @if(comment.vote === -1){
                <i class="pi pi-thumbs-down-fill"></i>
            } @else {
                <i class="pi pi-thumbs-down"></i>
            }
            @if(comment.voteCount<0){
                <span class="ml-2">{{comment.voteCount}} vote@if(comment.voteCount<-1){s}</span>
            }
        </p-button>
        <p-button icon="pi pi-reply" severity="secondary" variant="text" pTooltip="Reply" (click)="showReplyCommentDialog(comment._id)"></p-button>
    </div>

    @if(replyCommentDialogVisibleID==comment._id){
        <div class="flex flex-col mt-4">
            <textarea name="comment" pTextarea placeholder="Write a comment..." [(ngModel)]="createNewCommentData.comment" class="p-2 w-full h-24 resize-none transition-all duration-300 ease-in-out"></textarea>
            <div class="flex flex-row items-center justify-end mt-2 w-full h-12">
                <p-button icon="pi pi-times" label="Cancel" severity="secondary" variant="text" (click)="hideReplyCommentDialog()" class="transition-all duration-300 ease-in-out" ngClass="{{replyCommentDialogVisibleID==comment._id ? 'opacity-100' : 'opacity-0'}}"/>
                <p-button icon="pi pi-check" label="Share comment" pTooltip="Share comment" (click)="createNewComment()" class="transition-all duration-300 ease-in-out" ngClass="{{replyCommentDialogVisibleID==comment._id ? 'opacity-100' : 'opacity-0'}}"/>
            </div>
        </div>
    }

    @if(comment.replies && comment.replies?.length > 0){
        <div class="mt-4">
            @for(reply of comment.replies; track $index){
                @if(reply.status==true && reply.comment && reply.comment?.length>0){
                    <app-comment-thread [comment]="reply" [blogPostID]="blogPostID" [sessionUsername]="sessionUsername"></app-comment-thread>
                }
            }
        </div>
    }
</div>

@if(deleteCommentDialogVisible && deleteCommentData._id){
    <p-dialog header="Are you sure you want to delete this comment?" [(visible)]="deleteCommentDialogVisible" [modal]="true" [draggable]="false" [resizable]="false" [style]="{width: '50vw'}" (onhide)="hideDeleteCommentDialog()">
        <p>{{deleteCommentData.comment}}</p>
        <div class="flex flex-row items-center justify-end mt-6">
            <p-button icon="pi pi-times" severity="secondary" variant="text" label="Cancel" (click)="hideDeleteCommentDialog()"/>
            <p-button icon="pi pi-trash" variant="text" severity="danger" label="Delete" (click)="deleteComment()" disabled="{{deleteButtonSpamControl}}"/>
        </div>
    </p-dialog>
}
